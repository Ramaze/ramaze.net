
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Sessions &mdash; Ramaze v2011.01.30 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2011.01.30',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Ramaze v2011.01.30 documentation" href="../index.html" />
    <link rel="prev" title="Routes" href="routes.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="routes.html" title="Routes"
             accesskey="P">previous</a></li>
        <li><a href="../index.html">Ramaze v2011.01.30 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="sessions">
<h1>Sessions<a class="headerlink" href="#sessions" title="Permalink to this headline">¶</a></h1>
<p>The term sessions is used for data associated to a specific client. The easiest example
of a session is a simple cookie containing some very basic data such as a user&#8217;s name.</p>
<div class="section" id="initializing-sessions">
<h2>Initializing Sessions<a class="headerlink" href="#initializing-sessions" title="Permalink to this headline">¶</a></h2>
<p>Ramaze lazy-loads the session system that it&#8217;s ship with. This means that if you never use
any session related data a session will not be created. As soon as you call the main object
for working with sessions (simply called &#8220;session&#8221;) or add data to the flash (more on that
later) Ramaze will load the session adapter automatically. This prevents you from having
to manually write code that invokes a session for all your projects.</p>
<p>So how do we actually start a session? As mentioned earlier this can be done in two
different ways, calling session or flash. If you want to store data in the session
until the client&#8217;s session is destroyed (or the data is removed) it&#8217;s best to use
session, if you only want to store something until the client is redirected to another
page (or just visits a page himself) you should use flash.</p>
</div>
<div class="section" id="the-session-object">
<h2>The Session Object<a class="headerlink" href="#the-session-object" title="Permalink to this headline">¶</a></h2>
<p>As mentioned earlier session is used for data that should be stored until the client&#8217;s
session is destroyed or the data is removed. A good example of this sort of data is a
boolean that indicates if the user is logged in or not, you don&#8217;t want the user to
re-authenticate over and over again thus you store the data using the session object.
Storing data using this method is incredible simple and works a bit like you&#8217;re storing
data in a hash:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">session</span><span class="o">[</span><span class="ss">:logged_in</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
</pre></div>
</div>
<p>In the above example we stored a boolean with a value of &#8220;true&#8221; in the current client&#8217;s
session under the name &#8221;:logged_in&#8221;. If we want to retrieve this data somewhere else in
the application all we&#8217;d have to do is the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">session</span><span class="o">[</span><span class="ss">:logged_in</span><span class="o">]</span> <span class="c1"># =&gt; true</span>
</pre></div>
</div>
<p>A better example would be a simple counter that tracks the amount of times a user has
visited your application:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Counter</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="n">map</span> <span class="s1">&#39;/&#39;</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="c1"># If no data was found for the given key session returns nil</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">session</span><span class="o">[</span><span class="ss">:visits</span><span class="o">].</span><span class="n">nil?</span>
      <span class="n">session</span><span class="o">[</span><span class="ss">:visits</span><span class="o">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span>
      <span class="n">session</span><span class="o">[</span><span class="ss">:visits</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">end</span>

    <span class="s2">&quot;You have visitied this page </span><span class="si">#{</span><span class="n">session</span><span class="o">[</span><span class="ss">:visits</span><span class="o">]</span><span class="si">}</span><span class="s2"> times.&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>In this relatively basic controller a user&#8217;s amount of visits to the index() method will
be stored in the session and displayed afterwards. Now it&#8217;s time for the true magic.
The session object is an instance of Innate::Session and has a few extra methods besides
[] and []=. These methods are delete(), clear(), flush(), resid!() and sid(). We&#8217;re not
going to cover all methods but we will look at the delete() and resid() methods.</p>
</div>
<div class="section" id="session-delete">
<h2>Session.delete<a class="headerlink" href="#session-delete" title="Permalink to this headline">¶</a></h2>
<p>The method Session.delete can be used to remove a chunk of data from the client&#8217;s session.
In order to delete our amount of visits all we&#8217;d have to do is the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:visits</span><span class="p">)</span>
</pre></div>
</div>
<p>From this point on the &#8220;visits&#8221; key is set to nil until the user visits the index page
again.</p>
</div>
<div class="section" id="session-resid">
<h2>Session.resid!<a class="headerlink" href="#session-resid" title="Permalink to this headline">¶</a></h2>
<p>Session.resid! can be used to regenerate the client&#8217;s session ID without destroying the
session data. This method is extremely useful for authentication systems as it can be used
to prevent session fixation attacks by generating a new session ID every N minutes or
whenever a certain action is triggered (e.g. the user logs in). Using this method is very
simple and only requires the following to be done:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">session</span><span class="o">.</span><span class="n">resid!</span>
</pre></div>
</div>
</div>
<div class="section" id="the-flash">
<h2>The Flash<a class="headerlink" href="#the-flash" title="Permalink to this headline">¶</a></h2>
<p>First of all, this has nothing to do with Adobe&#8217;s Flash or <a class="reference external" href="http://en.wikipedia.org/wiki/The_Flash_(comic_book)">The Flash</a>. Flashdata is a
form of session data that is removed as soon as the client requests a new resource. This
means that if something is stored in the flash and the user is redirected the data will
be automatically removed. One of the things the flash data can be used for is storing
notifications that are displayed if a blog post has been saved successfully. Storing data
in the flash works similar to storing data in the session and can be done by calling the
flash object:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">flash</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Hello, Ramaze!&quot;</span>
</pre></div>
</div>
<p>If we want to remove something from the flash we can call Flash.delete similar to
Session.delete:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">flash</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:message</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that due to the nature of the flash data you&#8217;d have to do this before the client
requests a new resource as the data will be deleted automatically at that point.</p>
<p>Below is an example of how the flash data can be used in a typical Ramaze application:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Blogs</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="n">map</span> <span class="s1">&#39;/&#39;</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">set_message</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Hello, Ramaze!&quot;</span>
    <span class="n">redirect</span><span class="p">(</span><span class="no">Blogs</span><span class="o">.</span><span class="n">r</span><span class="p">(</span><span class="ss">:index</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If a client were to visit the index method for the first time nothing would be displayed
because the flash data isn&#8217;t there yet. As soon as the client visits /set_message he would
be redirected back to the index method and the message &#8220;Hello, Ramaze!&#8221; would be
displayed. Refreshing the page would clear the flash data and the message would no longer
be displayed until the client visits /set_message again.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Sessions</a><ul>
<li><a class="reference internal" href="#initializing-sessions">Initializing Sessions</a></li>
<li><a class="reference internal" href="#the-session-object">The Session Object</a></li>
<li><a class="reference internal" href="#session-delete">Session.delete</a></li>
<li><a class="reference internal" href="#session-resid">Session.resid!</a></li>
<li><a class="reference internal" href="#the-flash">The Flash</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="routes.html"
                        title="previous chapter">Routes</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/general/sessions.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="routes.html" title="Routes"
             >previous</a></li>
        <li><a href="../index.html">Ramaze v2011.01.30 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Michael Fellinger, Yorick Peterse.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>