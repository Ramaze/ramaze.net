
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Views &mdash; Ramaze v2011.01.30 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2011.01.30',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Ramaze v2011.01.30 documentation" href="../index.html" />
    <link rel="next" title="Helpers" href="../helpers/introduction.html" />
    <link rel="prev" title="Models" href="models.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../helpers/introduction.html" title="Helpers"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="models.html" title="Models"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Ramaze v2011.01.30 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="views">
<h1>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h1>
<p>Views are the last step in the process of a request to a MVC framework such as Ramaze.
A controller loads a model, the model processes a certain amount of data and the controller
will then pass this data to a view. The typical flow of a MVC framework (or any framework
using a view system) looks like the following:</p>
<div class="highlight-python"><pre>Request --&gt; Controller --&gt; View
              ^ |
              | '--&gt; Model
              |        |
              '--&lt;-----'</pre>
</div>
<p>The contents of a view is what the visitor of a page will eventually see. Looking back
at the waiter example introduced in the <a class="reference internal" href="controllers.html"><em>Controllers</em></a> chapter a view can be
seen as our dinner. It&#8217;s the end result we requested for but it has been modified
according to our order.</p>
<p>Ramaze has support for many different template engines and thus views can look quite
different. By default Ramaze uses a simple template engine called &#8220;Etanni&#8221;, Etanni was
developed by Michael Fellinger exclusively for Ramaze and is a very fast template engine.
In this chapter we&#8217;ll use Etanni to make it a bit easier to understand how views work.</p>
<div class="section" id="layouts">
<h2>Layouts<a class="headerlink" href="#layouts" title="Permalink to this headline">¶</a></h2>
<p>Ramaze also has a concept of layouts. Layouts are basically views for views and are
placed in the &#8220;layout&#8221; directory of your application. These views can be used to display
generic elements such as a navigation menu for all views. Because of this it&#8217;s recommended
to only place action specific markup in your views. Global elements such as navigation
menus or page titles should go in a layout.</p>
<p>In order to render a view inside a layout all you have to do is calling the &#8220;content&#8221;
instance variable. If we were to use Etanni (more on this later) our code would look like
the following:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
    #{@content}
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p>In order to use a layout we have to tell Ramaze to do so in our controller. Setting a
layout can be done in a few different ways. The easiest way is using the method &#8220;layout&#8221;
in your controller as following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Blogs</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="n">layout</span> <span class="s1">&#39;default&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This will tell Ramaze to use the layout &#8220;default.xhtml&#8221; for the Blogs controller. While
suited for most people there comes a time when you&#8217;re in the need of a more dynamic way
of assigning a layout. This can be done in two different ways. The first way is passing
a block to the layout() method:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Blogs</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="n">layout</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">path</span> <span class="o">===</span> <span class="s1">&#39;index&#39;</span>
      <span class="ss">:index_layout</span>
    <span class="k">else</span>
      <span class="ss">:alternative_layout</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>In this example two layouts are used, &#8220;index_layout&#8221; for the index() method and
&#8220;alternative_layout&#8221; for all other methods.</p>
<p>The second way is using the method &#8220;set_layout&#8221;. This method works almost identical to
layout() but has one big advantage: it can set method specific layouts. Changing the code
posted above so that it uses this method would look like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Blogs</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="c1"># Set our default layout</span>
  <span class="n">layout</span> <span class="s1">&#39;alternative_layout&#39;</span>

  <span class="c1"># Set our layout for the index() method</span>
  <span class="n">set_layout</span> <span class="s1">&#39;index_layout&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:index</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The set_layout method takes a hash where the keys are the names of the layouts to use
and the values the methods for which to use each layout. Below is another example that
specifies a few extra layout/method combinations.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Blogs</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="c1"># Set our default layout</span>
  <span class="n">layout</span> <span class="s1">&#39;default&#39;</span>

  <span class="c1"># Set our layout for the index() method</span>
  <span class="n">set_layout</span> <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:edit</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;extra&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:add</span><span class="p">,</span> <span class="ss">:synchronize</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-views">
<h2>Loading Views<a class="headerlink" href="#loading-views" title="Permalink to this headline">¶</a></h2>
<p>Loading views can be done in two different ways. When not explicitly calling a certain
view (or returning any data from the controller) Ramaze will try to load a matching view
for the current action. If the method &#8220;edit&#8221; was called Ramaze will try to load a view
called &#8220;edit&#8221;. Manually sending a response back can be done by returning a string from
the controller method that is called. Take a look at the example below.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Blogs</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="n">map</span> <span class="s1">&#39;/&#39;</span>

  <span class="k">def</span> <span class="nf">index</span>

  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">custom</span>
    <span class="s2">&quot;This is my custom response!&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">other</span>
    <span class="n">render_view</span> <span class="ss">:foobar</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If the user were to visit /index Ramaze would try to load the view &#8220;index.xhtml&#8221; (.xhtml
is the extension for Etanni templates) but when the user goes to /custom he&#8217;ll always
see the message &#8220;This is my custom response!&#8221;. This is because Ramaze will use the return
value of a controller method as the body for the response that will be sent back to the
visitor.</p>
<p>Let&#8217;s take a look at the other() method in our controller. As you can see it calls a
method &#8220;render_view&#8221;. This method is used to render a different view (in this case
foobar.xhtml) but without calling it&#8217;s action, once this is done the contents of the view
will be returned to the controller. When calling custom views you can use any of the
following methods:</p>
<ul class="simple">
<li>render_view</li>
<li>render_partial</li>
<li>render_file</li>
<li>render_custom</li>
<li>render_full</li>
</ul>
<div class="section" id="render-view">
<h3>render_view<a class="headerlink" href="#render-view" title="Permalink to this headline">¶</a></h3>
<p>As mentioned earlier this method is used to render a view without calling it&#8217;s action.
This can be useful if you have several methods that share the same view but feed it
different data. The usage of this method is quite simple, it&#8217;s first argument is the name
of the view to load (without the extension, Ramaze will figure this out) and the second
argument is a hash containing any additional variables to send to the view (more on this
later).</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="c1"># Render &quot;foo.xhtml&quot;</span>
<span class="n">render_view</span> <span class="ss">:foo</span>

<span class="c1"># Render &quot;foo.xhtml&quot; and send some extra data to it</span>
<span class="n">render_view</span> <span class="ss">:foo</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ramaze&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="render-partial">
<h3>render_partial<a class="headerlink" href="#render-partial" title="Permalink to this headline">¶</a></h3>
<p>The render_partial method works very similar to the render_view method, the difference
is that the render_partial method will not render a layout while render_view will.
This makes the render_partial method useful for responses to Ajax calls that don&#8217;t need
(or don&#8217;t want to) load both the view and the layout. This method has the same arguments
as the render_view method.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="c1"># Render the view &quot;partial.xhtml&quot;</span>
<span class="n">render_partial</span> <span class="ss">:partial</span>

<span class="c1"># Render the partial &quot;partial.xhtml&quot; and send some extra data to it</span>
<span class="n">render_partial</span> <span class="ss">:partial</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ramaze&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="render-file">
<h3>render_file<a class="headerlink" href="#render-file" title="Permalink to this headline">¶</a></h3>
<p>There comes a time when you may want to render a file that&#8217;s located somewhere else. For
this there is the render_file() method. This method takes a path, either relative or
absolute to a file that should be rendered. This can be useful if you have a cache
directory located outside of your project directory and you want to load a view from it.</p>
<p>The first argument of this method is a path to a file to render, the second argument is
a hash with variables just like the other render methods. Optionally this method accepts
a block that can be used to modify the current action.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="c1"># Render a file located in /tmp</span>
<span class="n">render_file</span> <span class="s1">&#39;/tmp/view.xhtml&#39;</span>

<span class="c1"># Render a file and send some extra data to it</span>
<span class="n">render_file</span> <span class="s1">&#39;/tmp/view.xhtml&#39;</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ramaze&quot;</span>

<span class="c1"># Render a file and modify the action</span>
<span class="n">render_file</span> <span class="s1">&#39;/tmp/view.xhtml&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">action</span><span class="o">|</span>
  <span class="c1"># Remove our layout</span>
  <span class="n">action</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="render-custom">
<h3>render_custom<a class="headerlink" href="#render-custom" title="Permalink to this headline">¶</a></h3>
<p>The render_custom() method can be used to create your personal render method and is
actually used by methods such as the render_partial method. The syntax is the same as
the render_file() method except that instead of a full path it&#8217;s first argument should
be the name of the action to render.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">render_custom</span> <span class="ss">:index</span> <span class="k">do</span> <span class="o">|</span><span class="n">action</span><span class="o">|</span>
  <span class="c1"># Remove the layout</span>
  <span class="n">action</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="kp">nil</span>

  <span class="c1"># Render the view without calling a method</span>
  <span class="n">action</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="render-full">
<h3>render_full<a class="headerlink" href="#render-full" title="Permalink to this headline">¶</a></h3>
<p>Last but not least there&#8217;s the render_full() method. This is the method Ramaze uses for
calling a controller along with it&#8217;s views and such. This method takes two arguments, the
first is the full path of the action to render and the second a hash that will be used
for the query string parameters. Please note that if this method is called in the first
request of a client you won&#8217;t have access to the session data and such, any following
calls will have access to this data.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="c1"># Calls Blogs#index</span>
<span class="n">render_full</span> <span class="s1">&#39;/blog/index&#39;</span>

<span class="c1"># Calls Blogs#edit(10)</span>
<span class="n">render_full</span> <span class="s1">&#39;/blog/edit/10&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="assigning-data">
<h2>Assigning Data<a class="headerlink" href="#assigning-data" title="Permalink to this headline">¶</a></h2>
<p>Assigning data to a view is very simple. Ramaze will copy all instance variables from the
current controller into the view. This means that if you have a variable &#64;user set to
&#8220;Yorick Peterse&#8221; this variable can be displayed in your view as following (assuming you&#8217;re
using Etanni):</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;p&gt;</span>Username: #{@user}<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
<p>Besides this you can assign custom data to a view by calling any of the render methods
and passing a hash to them.</p>
<p>Please note that the behavior or the syntax of displaying variables may change depending
on the template engine you&#8217;re using. While Etanni allows you to execute plain Ruby code
in your view a template engine such as Mustache won&#8217;t and thus may have a different
syntax. If we wanted to use Mustache and display our &#64;user variable it would have to be
done as following:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;p&gt;</span>Username: {{user}}<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="view-mapping">
<h2>View Mapping<a class="headerlink" href="#view-mapping" title="Permalink to this headline">¶</a></h2>
<p>Views are saved in the directory &#8220;view&#8221; and are saved according to the controller mapping.
If you have a controller that&#8217;s mapped to /modules/blog the index view will be located at
view/modules/blog/index.xhtml. Below are a few examples that show where the views are
located when passing different values to the map() method.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">map</span> <span class="s1">&#39;/&#39;</span>             <span class="c1"># view/index.html, view/edit.xhtml, etc</span>
<span class="n">map</span> <span class="s1">&#39;/blog&#39;</span>         <span class="c1"># view/blog/index.xhtml, view/blog/edit.xhtml, etc</span>
<span class="n">map</span> <span class="s1">&#39;/modules/blog&#39;</span> <span class="c1"># view/modules/blog/index.xhtml, view/modules/blog/edit.xhtml, etc</span>
</pre></div>
</div>
</div>
<div class="section" id="template-engines">
<h2>Template Engines<a class="headerlink" href="#template-engines" title="Permalink to this headline">¶</a></h2>
<p>At the time of writing (April 2011) Ramaze has support for the following template engines:</p>
<ul class="simple">
<li>Erector</li>
<li>Etanni</li>
<li>Erubis</li>
<li>Ezamar</li>
<li>HAML</li>
<li>Less</li>
<li>Gestalt</li>
<li>Liquid</li>
<li>Lokar</li>
<li>Maruku</li>
<li>Mustache</li>
<li>Nagoro</li>
<li>RedCloth</li>
<li>Remarkably</li>
<li>Sass</li>
<li>Slippers</li>
<li>Tagz</li>
<li>Tenjin</li>
</ul>
<p>All of these engines can be used on a per controller basis by calling the engine() method
and passing a symbol or string to it.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Blogs</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="n">engine</span> <span class="ss">:etanni</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The engine() method uses the provide() method (more on that in a second) to set the given
engine for all data sent back to the visitor with a content type of &#8220;text/html&#8221;. If you
want to use a certain engine for a different content type (e.g. application/json) you
can do so using the provide() method:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Blogs</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="c1"># Simple right?</span>
  <span class="n">provide</span><span class="p">(</span><span class="ss">:json</span><span class="p">,</span> <span class="ss">:erb</span><span class="p">)</span>

  <span class="c1"># Somewhat more verbose</span>
  <span class="n">provide</span><span class="p">(</span><span class="ss">:json</span><span class="p">,</span> <span class="ss">:engine</span> <span class="o">=&gt;</span> <span class="ss">:erb</span><span class="p">)</span>

  <span class="c1"># AWESOME!</span>
  <span class="n">provide</span><span class="p">(</span><span class="ss">:json</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
    <span class="c1"># &quot;value&quot; is the response body from our controller&#39;s method</span>
    <span class="n">value</span><span class="o">.</span><span class="n">to_json</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>It&#8217;s important to remember that the actions in the provide() method will only be executed
if it&#8217;s first parameter (in this case &#8220;json&#8221;) are appended to the URL as an extension.
A request to /hello would output HTML when using the above code, if we wanted JSON we&#8217;d
have to send a request to /hello.json.</p>
<p>The default template engine used by Ramaze is Etanni. Etanni is a small template engine
that ships with Ramaze (and Innate!) that&#8217;s extremely fast and has a very simple syntax.
Statements are wrapped in &lt;?r ?&gt; tags and rendering data can be done by wrapping the
variables in #{}:</p>
<div class="highlight-html"><div class="highlight"><pre># <span class="cp">&lt;?r ?&gt;</span> accepts regular Ruby code
<span class="cp">&lt;?r if @user.name === &#39;yorick&#39; ?&gt;</span>
<span class="nt">&lt;p&gt;</span>Hello Yorick<span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;?r else ?&gt;</span>
<span class="nt">&lt;p&gt;</span>And who are you?<span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;?r end ?&gt;</span>

# Display our name
#{@user.name}
</pre></div>
</div>
<p>Etanni can be very useful for most project but it&#8217;s <em>not</em> recommended to use it when you
want to allow a client to manage certain templates (e.g. Email layouts). This is because
Etanni allows you to execute regular Ruby code and thus someone could do some serious
damage to your server without even knowing it.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Views</a><ul>
<li><a class="reference internal" href="#layouts">Layouts</a></li>
<li><a class="reference internal" href="#loading-views">Loading Views</a><ul>
<li><a class="reference internal" href="#render-view">render_view</a></li>
<li><a class="reference internal" href="#render-partial">render_partial</a></li>
<li><a class="reference internal" href="#render-file">render_file</a></li>
<li><a class="reference internal" href="#render-custom">render_custom</a></li>
<li><a class="reference internal" href="#render-full">render_full</a></li>
</ul>
</li>
<li><a class="reference internal" href="#assigning-data">Assigning Data</a></li>
<li><a class="reference internal" href="#view-mapping">View Mapping</a></li>
<li><a class="reference internal" href="#template-engines">Template Engines</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="models.html"
                        title="previous chapter">Models</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../helpers/introduction.html"
                        title="next chapter">Helpers</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/general/views.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../helpers/introduction.html" title="Helpers"
             >next</a></li>
        <li class="right" >
          <a href="models.html" title="Models"
             >previous</a> |</li>
        <li><a href="../index.html">Ramaze v2011.01.30 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Michael Fellinger, Yorick Peterse.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>