
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Controllers &mdash; Ramaze v2011.01.30 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2011.01.30',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Ramaze v2011.01.30 documentation" href="../index.html" />
    <link rel="next" title="Models" href="models.html" />
    <link rel="prev" title="Ramaze Command" href="ramaze-command.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="models.html" title="Models"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="ramaze-command.html" title="Ramaze Command"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Ramaze v2011.01.30 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="controllers">
<h1>Controllers<a class="headerlink" href="#controllers" title="Permalink to this headline">¶</a></h1>
<p>When developing web applications controllers are the elements that are called by a browser.
When visiting a page a request is made that is processed by Rack and sent to Ramaze.
Ramaze in turn will determine what controller to call.</p>
<p>To make understanding controllers a bit easier will use a real world example. Let&#8217;s say
we&#8217;re in a restaurant and want to order some food. The waiter of the restaurant can be
seen as a controller. We&#8217;ll talk to it and tell him what we want to have for dinner but
the waiter itself won&#8217;t actually prepare our dinner, instead it will merely tell the cooks
to make the dinner and bring it to you once it&#8217;s done. The waiter is our controller, the
cook is our model and our meal can be seen as the view.</p>
<p>In a typical application the entire flow of a request is as following:</p>
<div class="highlight-python"><pre>Request --&gt; Server (Thin, Unicorn, etc) --&gt; Rack --&gt; Ramaze --&gt; Controller</pre>
</div>
<div class="section" id="ramaze-controllers">
<h2>Ramaze &amp; Controllers<a class="headerlink" href="#ramaze-controllers" title="Permalink to this headline">¶</a></h2>
<p>In Ramaze controllers are plain Ruby classes that extend Ramaze::Controller. The most
basic controller looks like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ControllerName</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="n">map</span> <span class="s1">&#39;/uri&#39;</span>

  <span class="k">def</span> <span class="nf">index</span>

  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Let&#8217;s walk through this snippet step by step. The first line declares a new class that
extends Ramaze::Controller. Extending this base class is very important, without it we
won&#8217;t be able to call controller specific methods such as the map() method. This method,
which is called on line 2, is used to instruct Ramaze what controller is bound to what
URI(Uniform Resource Identifier). The argument of this method should be a string starting
with a /. The reason for this is that the URIs are relative to URL the application is
running on. For example, if our application was running at ramaze.net a URI of &#8220;/blog&#8221;
would mean the controller can be found at ramaze.net/blog.</p>
<p>Let&#8217;s move to the next lines of code. The next lines of code define a new method called
&#8220;index&#8221;. By default Ramaze will try to call this method if no URI after the mapped URI
is given. In our /blog example a call to ramaze.net/blog would call BlogController#index
but a call to ramaze.net/blog/entry/10 would call BlogController#entry(10).</p>
<p>All methods that are declared as public can be accessed by a user and by default the
index() method is called if no other method is specified. Don&#8217;t like the index() method?
No problem, you can specify a different default method to call as following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ControllerName</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="n">trait</span> <span class="ss">:default_action_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;default&#39;</span>

  <span class="k">def</span> <span class="nf">default</span>

  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>We&#8217;re not going to cover Traits too much in this chapter as there&#8217;s a dedicated chapter
for them but in short they&#8217;re a way of setting configuration options. In this case we&#8217;re
using the trait &#8220;default_action_name&#8221; to specify what the name of the default method
should be. By default this is set to &#8220;index&#8221; but in the above example it was changed to
&#8220;default&#8221;.</p>
</div>
<div class="section" id="registering-controllers">
<h2>Registering Controllers<a class="headerlink" href="#registering-controllers" title="Permalink to this headline">¶</a></h2>
<p>By now you might be thinking &#8220;How does Ramaze know what controller to call? I didn&#8217;t
initialize the controller!&#8221;. It&#8217;s true, you don&#8217;t have to manually initialize the
controller and save it in a hash or somewhere else. The entire process of registering a
controller is done by the map() method and thus is one of the most important methods
available. When calling this method it will store the name of the class that invoked it
and bind it to the given URI. Whenever a request is made Ramaze simply creates an instance
of the matching controller for a given URI.</p>
<p>The basic process of the map() method is as following:</p>
<ol class="arabic simple">
<li>Call map().</li>
<li>Validate the given URI.</li>
<li>Store the controller constant.</li>
<li>Done.</li>
</ol>
</div>
<div class="section" id="base-controllers">
<h2>Base Controllers<a class="headerlink" href="#base-controllers" title="Permalink to this headline">¶</a></h2>
<p>In many applications you&#8217;ll have separate areas such as an admin panel and the frontend.
Usually you want to authenticate users for certain controllers, such as those used for
an admin panel. An easy way of doing this is by putting the authentication call in a
controller. By creating a base controller and extending it you don&#8217;t have to call the
method that authenticates the user over and over again. Because Ramaze is just Ruby all
you have to do to achieve this is the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AdminController</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>

<span class="k">end</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">AdminController</span>

<span class="k">end</span>
</pre></div>
</div>
<p>If your base controller has an initialize() method defined you should always call the
parent&#8217;s initialize() method to ensure everything is working properly. This can be done
by calling super():</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AdminController</span> <span class="o">&lt;</span> <span class="no">Ramaze</span><span class="o">::</span><span class="no">Controller</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="c1"># Calls Ramaze::Controller#initialize</span>
    <span class="k">super</span>

    <span class="c1"># Custom calls can be placed here...</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Controllers</a><ul>
<li><a class="reference internal" href="#ramaze-controllers">Ramaze &amp; Controllers</a></li>
<li><a class="reference internal" href="#registering-controllers">Registering Controllers</a></li>
<li><a class="reference internal" href="#base-controllers">Base Controllers</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ramaze-command.html"
                        title="previous chapter">Ramaze Command</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="models.html"
                        title="next chapter">Models</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/general/controllers.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="models.html" title="Models"
             >next</a></li>
        <li class="right" >
          <a href="ramaze-command.html" title="Ramaze Command"
             >previous</a> |</li>
        <li><a href="../index.html">Ramaze v2011.01.30 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Michael Fellinger, Yorick Peterse.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>