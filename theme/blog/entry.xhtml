<?r
entry = plugin(
  :section_entries,
  :section    => 'blog',
  :entry      => @request_uri[2],
  :comments   => true,
  :categories => true
)
section = plugin(:sections, :section => 'blog')

show_404 if !entry
?>
<!DOCTYPE html>
<html lang="#{plugin(:settings, :get, :language).value}">
    <head>
        #{partial(:head)}
    </head>
    <body>
        <!-- Global container for all elements -->
        <div class="container">
            <div id="container" class="row">
                <!-- Top part of the website containing the title and navigation menu -->
                <div id="top" class="grid_12">
                    #{partial(:header)}
                </div>

                <!-- Area containing all blog posts -->
                <div id="content" class="grid_12">
                    <section>
                        <article>
                            <header>
                                <h1>
                                    #{entry[:title]}
                                </h1>
                                <p class="meta">
                                    Written by #{entry[:user][:name]} on
                                    <time pubdate="pubdate"
                                    datetime="#{entry[:created_at].strftime('%Y-%m-%d')}">
                                        #{entry[:created_at].strftime('%A, %B %d, %Y')}
                                    </time>
                                </p>
                            </header>

                            #{entry[:fields][:body]}

                            <footer>
                                <p>
                                    Posted in:
                                    #{entry[:categories].map { |c| c[:name] }.join(', ') }
                                    |
                                    <?r if entry[:comments].count === 1 ?>
                                    1 comment
                                    <?r else ?>
                                    #{entry[:comments].count} comments
                                    <?r end ?>
                                </p>
                            </footer>
                        </article>
                    </section>

                    <!-- Comments, yay -->
                    <?r if section[:comment_allow] === true ?>
                    <section id="comments">
                        <h1>Comments</h1>

                        <?r if entry[:comments].count === 0 ?>
                        <p>No comments have been posted yet.</p>
                        <?r else; entry[:comments].each do |comment| ?>
                        <article>
                            <header>
                                <h1>
                                    <a href="#{comment[:website]}">
                                        #{comment[:name]}
                                    </a>
                                </h1>
                                <p class="meta">
                                    <time pubdate="pubdate"
                                    datetime="#{comment[:created_at].strftime('%Y-%m-%d')}">
                                        #{comment[:created_at].strftime('%A, %B %d, %Y')}
                                    </time>
                                </p>
                            </header>
                            <p>#{comment[:comment]}</p>
                        </article>
                        <?r end; end ?>
                    </section>

                    #{partial(:comments_form, :section_entry => entry[:id])}
                    <?r end ?>
                </div>
            </div>

            #{partial(:footer)}
        </div>
    </body>
</html>
